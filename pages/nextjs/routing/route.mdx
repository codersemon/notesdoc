## route.js for backend

nextjs à¦à¦•à¦Ÿà¦¿ full-stack framework. à¦à¦Ÿà¦¾ à¦¦à¦¿à§Ÿà§‡ backend & frontend à¦¸à¦¬à¦•à¦¿à¦›à§à¦‡ à¦¬à¦¾à¦¨à¦¾à¦¨à§‹ à¦¸à¦®à§à¦­à¦¬à¥¤ à¦†à¦° à¦à¦‡ backend REST API à¦¬à¦¾à¦¨à¦¾à¦¨à§‹à¦° à¦œà¦¨à§à¦¯ `route.js/route.ts` file à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦¹à§Ÿà§‡ à¦¥à¦¾à¦•à§‡à¥¤

[ðŸ”— Reference](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)

## Supported HTTP Methods

`GET`, `POST`, `PUT`, `PATCH`, `DELETE`, `HEAD`, and `OPTIONS`. à¦¯à¦¦à¦¿ unsupported à¦•à§‹à¦¨ method call à¦•à¦°à¦¾ à¦¹à§Ÿ, à¦¤à¦¾à¦¹à¦²à§‡ Next.js `405 Method Not Allowed` response à¦ªà¦¾à¦ à¦¾à¦¬à§‡à¥¤

[ðŸ”— Reference](https://nextjs.org/docs/app/building-your-application/routing/route-handlers#supported-http-methods)

## `GET` Request

GET request à¦à¦° response à¦ return new Response() à¦à¦­à¦¾à¦¬à§‡ return à¦•à¦°à¦¾ à¦¯à¦¾à¦¬à§‡, à¦à¦•à§à¦·à§‡à¦¤à§à¦°à§‡ à¦…à¦¬à¦¶à§à¦¯à¦‡ new Response(data) return à¦•à¦°à¦¤à§‡ à¦¹à¦¬à§‡à¥¤

```js copy showLineNumbers filename="app/api/blogs/route.js" {6}
// dependencies
import { blogs } from "@/data/blogs";

// get all blogs
export const GET = async () => {
  return new Response(JSON.stringify(blogs));
};
```

à¦…à¦¥à¦¬à¦¾ json() respone send à¦•à¦°à¦¾ à¦¯à¦¾à¦¬à§‡à¥¤ à¦à¦•à§à¦·à§‡à¦¤à§à¦°à§‡ à¦¶à§à¦§à§à¦®à¦¾à¦¤à§à¦° Response.json(data) return à¦•à¦°à¦¤à§‡ à¦¹à¦¬à§‡à¥¤

```js copy showLineNumbers filename="app/api/blogs/route.js" {6}
// dependencies
import { blogs } from "@/data/blogs";

// get all blogs
export const GET = async () => {
  return Response.json(blogs);
};
```

## `GET` Request `Single` Data

singe data get à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯ parameter à¦à¦° help à¦¨à¦¿à¦¤à§‡ à¦¹à¦¬à§‡à¥¤ à¦†à¦° dynamic route à¦¬à¦¾à¦¨à¦¾à¦¤à§‡ à¦¹à¦¬à§‡ à¦†à¦—à§‡à¦° à¦¨à¦¿à§Ÿà¦®à§‡à¦‡à¥¤ GET request à¦à¦° à¦®à¦§à§à¦¯à§‡ 1st parameter â€œrequestâ€ , 2nd parameter â€œparamsâ€ object à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿà¥¤ à¦¯à§‡à¦Ÿà¦¾à¦° params object à¦à¦° à¦®à¦§à§à¦¯à§‡ à¦à¦­à¦¾à¦¬à§‡ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à¦¬à§‡ à¦à¦–à¦¨ params à¦ à¦ªà¦¾à¦“à§Ÿà¦¾ id à¦•à§‡ destructure à¦•à¦°à§‡ parseInt(params.id) à¦•à¦°à§‡ à¦¡à§‡à¦Ÿà¦¾à¦¬à§‡à¦¸à§‡ find à¦•à¦°à§‡ json response send à¦•à¦°à¦¤à§‡ à¦¹à¦¬à§‡à¥¤ parseInt à¦•à¦°à¦¾à¦° à¦•à¦¾à¦°à¦£ à¦¹à¦šà§à¦›à§‡ url parameter à¦ à¦ªà¦¾à¦“à§Ÿà¦¾ dynamic id string format à¦à¦° à¦¹à§Ÿà§‡ à¦¥à¦¾à¦•à§‡à¥¤ à¦†à¦° à¦à¦–à¦¾à¦¨à§‡ id param à¦†à¦¸à¦¾à¦° à¦•à¦¾à¦°à¦£ à¦¹à¦šà§à¦›à§‡ route à¦à¦° dynamic folder [id] à¦à¦­à¦¾à¦¬à§‡ à¦¨à§‡à¦“à§Ÿà¦¾ à¦¹à§Ÿà§‡à¦›à§‡à¥¤

```js showLineNumbers copy filename="app/api/blogs/[id]/route.js" {5, 7}
// dependencies
import { blogs } from "@/data/blogs";

// get single blog
export const GET = async (req, { params }) => {
  // getting blog id from parameter
  const { id } = params;

  // get blog
  const blog = blogs.find((blog) => blog.id === parseInt(id));

  // if blog not found
  if (!blog) {
    return new Response(
      JSON.stringify({ message: `Blog not found with blog id ${id}!` }),
      {
        status: 404,
      }
    );
  }

  // send response
  return Response.json(blog);
};
```

## `POST` Request

à¦¨à¦¤à§à¦¨ à¦¡à§‡à¦Ÿà¦¾ à¦¯à¦¦à¦¿ à¦¡à§‡à¦Ÿà¦¾à¦¬à§‡à¦¸à§‡ à¦¸à§‡à¦­ à¦•à¦°à¦¤à§‡ à¦šà¦¾à¦‡, à¦¤à¦¾à¦¹à¦²à§‡ POST method à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¤à§‡ à¦¹à¦¬à§‡à¥¤ à¦¸à¦¬ controller async function à¦¬à¦¾à¦¨à¦¾à¦¨à§‹ à¦‰à¦šà¦¿à¦¤à¥¤ POST method à¦à¦° first parameter à¦ request à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿà¥¤ à¦†à¦®à¦°à¦¾ à¦¯à§‡à¦¹à§‡à¦¤à§ json type data send à¦•à¦°à§‡à¦›à¦¿ à¦¤à¦¾à¦‡ request.json() à¦à¦° à¦®à¦¾à¦§à§à¦¯à¦®à§‡ data receive à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‹à¥¤ à¦¨à¦¿à¦šà§‡à¦° à¦‰à¦¦à¦¾à¦¹à¦°à¦£à§‡ à¦¯à§‡à¦¹à§‡à¦¤à§ database à¦¹à¦¿à¦¸à§‡à¦¬à§‡ à¦à¦•à¦Ÿà¦¾ array of object use à¦•à¦°à§‡à¦›à¦¿, à¦¤à¦¾à¦‡ à¦¸à§‡à¦‡ array à¦à¦° à¦®à¦§à§à¦¯à§‡ push à¦•à¦°à§‡ new created data return à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡à¥¤ `Response.json(data, {options})` à¦à¦–à¦¾à¦¨à§‡ 2nd arguments à¦à¦° à¦®à¦§à§à¦¯à§‡ status, headers etc send à¦•à¦°à¦¾ à¦¯à¦¾à§Ÿà¥¤

```js copy showLineNumbers filename="app/api/blogs/route.js" {4, 15-20}
// create blog
export const POST = async (request) => {
  // getting payload
  const data = await request.json();

  // calculate nextId
  const nextId = blogs[blogs?.length - 1].id + 1;

  // new blog
  const newBlog = { id: nextId, ...data };

  // add new blog in db
  blogs.push(newBlog);

  return new Response(JSON.stringify(newBlog), {
    headers: {
      "Content-Type": "application/json",
    },
    status: 201,
  });
};
```

## `DELETE` Request

à¦•à§‹à¦¨ single data delete à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯ params à¦à¦° à¦®à¦§à§à¦¯à§‡ id à¦¦à¦¿à§Ÿà§‡ DELETE Request send à¦•à¦°à¦¤à§‡ à¦¹à¦¬à§‡à¥¤ à¦¨à¦¿à¦šà§‡ à¦à¦•à¦Ÿà¦¿ array of object à¦¥à§‡à¦•à§‡ data delete à¦•à¦°à§‡ à¦¦à§‡à¦–à¦¾à¦¨à§‹ à¦¹à§Ÿà§‡à¦›à§‡à¥¤ à¦†à¦¸à¦²à§‡ à¦à¦‡ Delete à¦à¦° à¦¬à§à¦¯à¦¾à¦ªà¦¾à¦°à¦Ÿà¦¾ vary à¦•à¦°à§‡ data à¦•à¦¿ database à¦¨à¦¾à¦•à¦¿ à¦•à§‹à¦¨ array of object à¦¥à§‡à¦•à§‡ delete à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡, à¦•à§‡à¦¨à¦¨à¦¾ à¦­à¦¿à¦¨à§à¦¨ data source à¦à¦° à¦œà¦¨à§à¦¯ à¦­à¦¿à¦¨à§à¦¨ system à¦ data delete handle à¦•à¦°à¦¾ à¦¹à¦¬à§‡à¥¤

```js copy showLineNumbers filename="app/api/blogs/[id]/route.js" {}
// delete single blog
export const DELETE = async (_req, { params }) => {
  // get id
  const { id } = params;

  // deletable blog index
  const editableBlogIndex = blogs.findIndex((blog) => blog.id === parseInt(id));

  //   remove blog
  blogs.splice(editableBlogIndex, 1);

  return Response.json(blogs);
};
```

## `PATCH` à¦“ `PUT` Request

à¦•à§‹à¦¨ Data partially update à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯ PATCH method à¦†à¦° fully update à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯ PUT method à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¾ à¦¹à§Ÿà§‡ à¦¥à¦¾à¦•à§‡à¥¤ à¦à¦‡ à¦¦à§à¦‡ à¦§à¦°à¦¨à§‡à¦° request à¦à¦° à¦œà¦¨à§à¦¯ à¦à¦•à¦‡ à¦§à¦°à¦¨à§‡à¦° controller à¦¦à¦¿à§Ÿà§‡à¦‡ à¦•à¦¾à¦œ à¦¹à§Ÿà§‡ à¦¯à¦¾à§Ÿà¥¤

```js copy showLineNumbers filename="app/api/blogs/[id]/route.js" {}
// edit single blog
export const PATCH = async (req, { params }) => {
  // getting data
  const data = await req.json();
  const { id } = params;

  // editable blog index
  const editableBlogIndex = blogs.findIndex((blog) => blog.id === parseInt(id));

  blogs[editableBlogIndex] = { ...blogs[editableBlogIndex], ...data };

  return Response.json(blogs);
};
```

## Redirection

API route à¦à¦° à¦®à¦§à§à¦¯à§‡à¦‡ à¦ªà§à¦°à§Ÿà§‹à¦œà¦¨à§‡ `redirect` à¦•à¦°à¦¾à¦¨à§‹ à¦¸à¦®à§à¦­à¦¬à¥¤ à¦¨à¦¿à¦šà§‡à¦° à¦‰à¦¦à¦¾à¦¹à¦°à¦£à§‡ single blog à¦¯à¦¦à¦¿ database à¦ à¦¨à¦¾ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿ, à¦¤à¦–à¦¨ blogs segment à¦ redirect à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡à¥¤ à¦«à¦²à§‡, blogs segment à¦ get request à¦ à¦¯à§‡ response à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à§‡à¦¤ à¦¸à§‡à¦Ÿà¦¾ return à¦•à¦°à¦¬à§‡à¥¤

```js copy showLineNumbers filename="app/api/blogs/[id]/route.js" {3, 14-16}
// dependencies
import { blogs } from "@/data/blogs";
import { redirect } from "next/navigation";

// get single blog
export const GET = async (req, { params }) => {
  // getting blog id from parameter
  const { id } = params;

  // get blog
  const blog = blogs.find((blog) => blog.id === parseInt(id));

  // redirect to all blogs if blog not found
  if (!blog) {
    redirect("/api/blogs");
  }

  // send response
  return Response.json(blog);
};
```

## Headers

### Get Request headers

à¦ªà§à¦°à¦¤à¦¿à¦Ÿà¦¾ HTTP Request & Response à¦à¦° à¦¸à¦¾à¦¥à§‡à¦‡ headers pass à¦¹à§Ÿà§‡ à¦¥à¦¾à¦•à§‡à¥¤ à¦†à¦®à¦°à¦¾ à¦†à¦®à¦¾à¦¦à§‡à¦° à¦ªà§à¦°à§Ÿà§‹à¦œà¦¨à§‡ Request à¦“ Response à¦‰à¦­à§Ÿ header set & read à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¿à¥¤ Request headers set à¦•à¦°à¦¾ à¦¹à§Ÿ à¦¯à§‡ client à¦¥à§‡à¦•à§‡ request à¦•à¦°à¦¾ à¦¹à§Ÿ à¦¸à§‡à¦–à¦¾à¦¨ à¦¥à§‡à¦•à§‡à¥¤ à¦†à¦° Response headers set à¦•à¦°à¦¾ à¦¹à§Ÿ server à¦¥à§‡à¦•à§‡à¥¤

à¦¨à¦¿à¦šà§‡ Request headers read à¦•à¦°à¦¾à¦° à¦ªà¦¦à§à¦§à¦¤à¦¿ à¦¦à§‡à¦–à¦¾à¦¨à§‹ à¦¹à§Ÿà§‡à¦›à§‡à¥¤ Request headers read à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯ `next/headers` à¦¥à§‡à¦•à§‡ `headers` à¦¨à¦¾à¦®à§‡ à¦à¦•à¦Ÿà¦¿ function à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿà¥¤ à¦à¦‡ function invoke à¦•à¦°à¦²à§‡à¦‡ headersList à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à¦¬à§‡, à¦¯à¦¦à¦¿ sepecific à¦•à§‹à¦¨ header à¦ªà§‡à¦¤à§‡ à¦šà¦¾à¦‡ à¦¤à¦¾à¦¹à¦²à§‡ `headers()` invoke à¦•à¦°à§‡ à¦¸à§‡à¦Ÿà¦¾à¦° à¦‰à¦ªà¦°à§‡ `get()` à¦¦à¦¿à¦²à§‡à¦‡ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à¦¬à§‡à¥¤ à¦¨à¦¿à¦šà§‡ `Authorization` get à¦•à¦°à§‡ à¦¦à§‡à¦–à¦¾à¦¨à§‹ à¦¹à§Ÿà§‡à¦›à§‡à¥¤

```js copy showLineNumbers filename="app/api/profile/route.js" {1,4,6}
import { headers } from "next/headers";

export const GET = async () => {
  const headerList = headers();

  console.log(headerList.get("Authorization"));

  return Response.json("Profile route!");
};
```

### Set Response headers

à¦¨à¦¿à¦šà§‡ Response headers à¦à¦° à¦®à¦§à§à¦¯à§‡ `Content-Type` set à¦•à¦°à§‡ à¦¦à§‡à¦“à§Ÿà¦¾ à¦¹à§Ÿà§‡à¦›à§‡à¥¤ à¦†à¦° Response à¦à¦° à¦®à¦§à§à¦¯à§‡ à¦•à¦¿à¦›à§ add à¦•à¦°à¦¤à§‡ à¦šà¦¾à¦‡à¦²à§‡ Response à¦à¦° instance create à¦•à¦°à§‡ à¦•à¦¾à¦œ à¦•à¦°à¦¤à§‡ à¦¹à¦¬à§‡, à¦¯à§‡à¦Ÿà¦¾ à¦¨à¦¿à¦šà§‡ follow à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡à¥¤

```js copy showLineNumbers {3-7}
export const GET = async () => {

  return new Response(JSON.stringify({...}), {
    headers: {
      "Content-Type": "application/json"
    }
  });
};
```

## Cookies

Client à¦à¦° Cookies set à¦à¦¬à¦‚ get à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯ `next/headers` à¦à¦° à¦®à¦§à§à¦¯à§‡ `cookies()` à¦¨à¦¾à¦®à§‡ à¦à¦•à¦Ÿà¦¿ function à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿà¥¤

### Set cookies

à¦¨à¦¿à¦šà§‡ `theme` à¦¨à¦¾à¦®à§‡ à¦à¦•à¦Ÿà¦¿ cookie set à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡, à¦¯à§‡à¦Ÿà¦¾à¦° à¦­à§‡à¦²à§ `dark` à¦°à¦¾à¦–à¦¾ à¦¹à§Ÿà§‡à¦›à§‡à¥¤ cookie set à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯ `next/headers` à¦¥à§‡à¦•à§‡ `cookies` named import à¦•à¦°à¦¤à§‡ à¦¹à¦¬à§‡à¥¤ à¦à¦‡ function à¦à¦° `set()` method à¦¦à¦¿à§Ÿà§‡ `key` & `value` pair à¦¹à¦¿à¦¸à§‡à¦¬à§‡ cookie à¦¸à§‡à¦Ÿ à¦•à¦°à¦¤à§‡ à¦¹à¦¬à§‡à¥¤

```js copy showLineNumbers {1,5}
import { cookies } from "next/headers";

export const GET = async () => {
  // set cookies
  cookies().set("theme", "dark");

  return Response.json("Profile route!");
};
```

### Get cookies

cookie get à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯ `cookies()` à¦¥à§‡à¦•à§‡ `get()` method à¦à¦° à¦®à¦§à§à¦¯à§‡ cookie set à¦•à¦°à¦¾à¦° à¦¸à¦®à§Ÿ à¦¯à§‡ `key` à¦¦à§‡à¦“à§Ÿà¦¾ à¦¹à§Ÿà§‡à¦›à¦¿à¦² à¦¸à§‡à¦Ÿà¦¾ à¦¦à¦¿à¦²à§‡à¦‡ à¦ cookie à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à¦¬à§‡à¥¤

```js copy showLineNumbers {}
import { cookies } from "next/headers";

export const GET = async () => {
  // get theme from cookie
  console.log(cookies().get("theme"));

  return Response.json("Profile route!");
};
```

## Caching

nextjs by default à¦¸à¦•à¦² static `GET` method à¦•à§‡ cache à¦•à¦°à¦¾ à¦°à¦¾à¦–à§‡à¥¤

### à¦•à¦–à¦¨ à¦•à¦–à¦¨ cache à¦¹à§Ÿ à¦¨à¦¾? 
- `export const dynamic = "force-static"` à¦à¦Ÿà¦¿ à¦¯à¦–à¦¨ à¦•à§‹à¦¨ route.js à¦à¦° à¦à¦•à¦¦à¦® à¦‰à¦ªà¦°à§‡ à¦°à¦¾à¦–à¦¾ à¦¹à¦¬à§‡à¥¤ 
- à¦•à§‹à¦¨ dynamic segment à¦à¦° à¦®à¦§à§à¦¯à§‡à¦•à¦¾à¦° `GET` method à¦•à§‡ cache à¦•à¦°à§‡ à¦¨à¦¾à¥¤ à¦¯à§‡à¦®à¦¨à¦ƒ `api/blog/[id]/route.js` à¦à¦‡ à¦«à¦¾à¦‡à¦²à§‡à¦° à¦®à¦§à§à¦¯à§‡ à¦¯à§‡ GET method à¦¥à¦¾à¦•à¦¬à§‡ à¦¸à§‡à¦Ÿà¦¾ cache à¦¹à¦¬à§‡ à¦¨à¦¾à¥¤ 
- à¦¯à¦¦à¦¿ GET method à¦à¦° à¦®à¦§à§à¦¯à§‡ à¦•à§‹à¦¨ dynamic function à¦¥à¦¾à¦•à§‡à¥¤ à¦¯à§‡à¦®à¦¨à¦ƒ `headers()`, `cookies()`
- GET method à¦›à¦¾à§œà¦¾ à¦¬à¦¾à¦•à¦¿ à¦¸à¦¬ method à¦•à§‹à¦¨à¦Ÿà¦¾à¦‡ cache à¦¹à¦¬à§‡ à¦¨à¦¾à¥¤ 

### GET method à¦à¦° à¦®à¦§à§à¦¯à§‡ à¦•à¦¿à¦­à¦¾à¦¬à§‡ cache à¦¬à¦¨à§à¦§ à¦•à¦°à¦¾ à¦¯à¦¾à§Ÿ?

à¦¯à§‡ route à¦à¦° GET method à¦•à§‡ cache à¦•à¦°à¦¤à§‡ à¦¨à¦¾ à¦šà¦¾à¦‡, à¦¸à§‡à¦Ÿà¦¾à¦° à¦‰à¦ªà¦°à§‡ à§§à¦® à¦²à¦¾à¦‡à¦¨à§‡à¦° à¦ à¦•à§‹à¦¡ à¦¦à¦¿à§Ÿà§‡ à¦¦à¦¿à¦¤à§‡ à¦¹à¦¬à§‡à¥¤ à¦†à¦° à¦¯à§‡à¦­à¦¾à¦¬à§‡ à¦†à¦›à§‡ à¦¸à§‡à¦­à¦¾à¦¬à§‡à¦‡ à¦¦à¦¿à¦¤à§‡ à¦¹à¦¬à§‡à¥¤

```js copy showLineNumbers {1}
export const dynamic = "force-static";

export const GET = async () => {
  return Response.json("Profile route!");
};
```

